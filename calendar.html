<!DOCTYPE html>
<html>
<head>
  <title>Food Truck Information</title>
    
  <link rel="stylesheet" type="text/css" href="assets\css\form.css">
  <link rel="stylesheet" type="text/css" href="assets\css\jQueryUI.css">
  <link rel="stylesheet" type="text/css" href="assets\css\timepicker.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="assets\css\stylish-portfolio.css">
  <link rel="stylesheet" type="text/css" href="assets\css\jQueryUI.css">
  <link rel="stylesheet" type="text/css" href="assets\css\timepicker.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  <!-- Custom Fonts -->
  <link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
</head>

<!-- nav bar-->

<nav class="navbar navbar-default">
  <div class="container-fluid">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="index.html">Orlando Local Food Trucks</a>
    </div>
    
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
      <li><a href="search.html">Search</a></li>
        <li class="active"><a href="calendar.html">Calendar</a></li>
        <li><a href="form.html">Add Your truck</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <!-- Header -->
  <header id="top" class="header">
    <div class="text-vertical-center">
        <div class="calpad">
        <h1>Orlando Trucks Calendar</h1>
    </div>  
    <h3 class="calsub">Check out our calendar below for up to date Orlando Food Truck events and locations.</h3>        
      
    <div class="calendar">
      <iframe class="cal" src="https://calendar.google.com/calendar/embed?height=600&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=orlfoodtrucks%40gmail.com&amp;color=%231B887A&amp;ctz=America%2FNew_York" style="border-width:0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
    </div>
 </header>

 <!-- map-->
<section id="services" class="services">
    <div class="container">
      <div class="row text-center">
               <!--For Map API-->
              <div class="row text-center form">
              <h2>Find the Location</h2>
              <input id="search" type="text">
              <button id="submit">Submit</button>
              </div>
              <div class="row map-view">
                <div id="map" class="col-xs-12"></div>
                <div id="map-directions" class="col-xs-12"></div>
              </div>
            </div>
          </div>
         </div>
        </section>  
        </div>
        </div>

<!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-10 col-lg-offset-1 text-center">
            <h4><strong>Orlando Local Food Trucks</strong></h4>
              <ul class="list-inline">
                 <li><a href="https://www.facebook.com/" target="_blank"><i class="fa fa-facebook fa-fw fa-3x"></i></a></li>
                <li><a href="https://twitter.com" target="_blank"><i class="fa fa-twitter fa-fw fa-3x"></i></a></li>
                <li><a href="https://yelp.com" target="_blank"><i class="fa fa-yelp fa-fw fa-3x"></i></a></li>
              </ul>
                <hr class="small">
                <p class="text-muted">Copyright &copy; Orlando Local Food Trucks 2016</p>
                 <a id="to-top" href="#top" class="btn btn-dark btn-lg"><i class="fa fa-chevron-up fa-fw fa-1x"></i></a>
          </div>
        </div>
      </div> 
    </footer>


<!-- scripts-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
<script   src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"   integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E="   crossorigin="anonymous"></script>
<script type="text/javascript" src="assets\js\timepicker.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.2.1/firebase.js"></script>
<script type="text/javascript" src="assets\js\form.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>

  markers = [];

  function initMap() {
    mapDiv = document.getElementById('map');
    map = new google.maps.Map(mapDiv, {
      //set center of map on load
      center: {lat: 28.538335, lng: -81.379236},
      //set zoom, lower number means zoom out, and vice versa
      zoom: 9,
      //you can set map type to roadmap, terrain, satellite, or hybrid
      mapTypeId: 'terrain',
      //If you plan to move a control on the screen
      //it is recommened to set that control to true to always show
      mapTypeControl: true,
      //this sets the position, go to docs to see other positions
      mapTypeControlOptions: {
      position: google.maps.ControlPosition.TOP_LEFT
      },
      //same as before, just different controls
      fullscreenControl: true,
      fullscreenControlOptions: {
      position: google.maps.ControlPosition.LEFT_TOP
      },
      streetViewControl: true,
      streetViewControlOptions: {
      position: google.maps.ControlPosition.LEFT_TOP 
      },
      zoomControl: true,
      zoomControlOptions: {
      position: google.maps.ControlPosition.LEFT_TOP
      }
    });
    // for Autocomplete search
     autoSearch = new google.maps.places.Autocomplete(document.getElementById('search'));
     geocoder = new google.maps.Geocoder();
  }
  // when the submit button is clicked
  $('#submit').on('click', function(){

  // loop through locations
    for (var i = 0; i < markers.length; i++){
      // removew marker from map to do a new search. 
       markers[i].setMap(null);
    }

    // get the search value
    var searchValue = $('#search').val();

      // use geocoder
    geocoder.geocode({'address': searchValue}, function(results, status) {

      if(status === 'OK'){
          var geometry = results[0].geometry.location;
          latitude = geometry.lat();
          longitude = geometry.lng();        
          console.log('lat: ' + location + ', lng: ' + longitude);
          
          // set marker at location
          var marker = new google.maps.Marker({
            position: {'lat': latitude, 'lng': longitude},
            map:map
        });

        // here is were we add a new marker for each location
        //center map to marker clicked
        marker.addListener('click', function(){

         // this refers to the marker that is clicked
         map.setCenter(this.getPosition());

        });

        //center the map to the market position
        map.setCenter(marker.getPosition());

        // add it to the marker array
        markers.push(marker);

          // location that are near each other "marker"
        locations = [
          {'lat': latitude + 0.1, 'lng': longitude + 0.1},
          {'lat': latitude + 0.1, 'lng': longitude + 0.1},
          {'lat': latitude + 0.1, 'lng': longitude + 0.1},
          {'lat': latitude + 0.1, 'lng': longitude + 0.1}
        ];

        // loop through locations
        for (var i = 0; i < locations.length; i++) {
           // make a new marker for each location
          //     marker = new google.maps.Marker({
          //     position: locations[i],
          //     map: map
          // });

          // show direction on click
          marker.addListener('click', function(){
           if(typeof renderer !== 'undefined'){
            // remove step by step directions
            $('#map-directions').html('');
            // remove renderer route from map
            renderer.setMap(null);
           }
           // use Directions Service to get direction
           var directionsService = new google.maps.DirectionsService();

           // this will be the options passed into the Directions Service object
           var directionsRequest = {
            origin: markers[0].getPosition(),
            destination: this.getPosition(),
            travelMode: google.maps.DirectionsTravelMode.DRIVING
           }

           directionsService.route(
            directionsRequest,
            function(response, status){
              if(status === google.maps.DirectionsStatus.OK){
                renderer = new google.maps.DirectionsRenderer({
                  map: map,
                  directions: response
                });
                renderer.setPanel(document.getElementById('map-directions'));
              }else{
                console.log('unable to retreive route.')
              }
            });
           //this refers to the marker that is clicked
           // map.setCenter(this.getPosition());
          });

            // add it to the markers array
           markers.push(marker)
    }
   } 


  });


});

</script>
<!-- google map-->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChFKfGT-QBuYU5Wqu9jonp9Rp2sb0S35w&libraries=places&callback=initMap" type="text/javascript"></script>

</body>

</html>